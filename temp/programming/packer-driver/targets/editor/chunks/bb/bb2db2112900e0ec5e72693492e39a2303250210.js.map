{"version":3,"sources":["file:///Users/mike/Documents/self/game-2d-demo/assets/scripts/components/CameraFollow.ts"],"names":["ccclass","property","cc","_decorator","CameraFollow","Node","Camera","Component","initialPosition","onLoad","initializeCamera","start","camera","node","position","clone","update","deltaTime","target","followTarget","getComponent","console","error","log","targetPosition","currentPosition","targetX","x","targetY","y","followX","offsetX","followY","offsetY","newPosition","smoothFollow","lerpFactor","followSpeed","v3","lerp","z","setTarget","setOffset","setFollowSpeed","speed"],"mappings":"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","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n/**\n * 相機跟隨組件\n * 讓相機平滑跟隨目標物件移動\n */\n@ccclass('CameraFollow')\nexport class CameraFollow extends cc.Component {\n    @property(cc.Node)\n    target: cc.Node = null;\n\n    @property(cc.Camera)\n    camera: cc.Camera = null;\n\n    @property\n    followSpeed: number = 5;\n\n    @property\n    offsetX: number = 0;\n\n    @property\n    offsetY: number = 0;\n\n    @property\n    smoothFollow: boolean = true;\n\n    @property\n    followX: boolean = true;\n\n    @property\n    followY: boolean = true;\n\n    private initialPosition: cc.Vec3 = null;\n\n    onLoad() {\n        this.initializeCamera();\n    }\n\n    start() {\n        if (this.camera && this.camera.node) {\n            this.initialPosition = this.camera.node.position.clone();\n        }\n    }\n\n    update(deltaTime: number) {\n        if (this.target && this.camera) {\n            this.followTarget(deltaTime);\n        }\n    }\n\n    /**\n     * 初始化相機\n     */\n    private initializeCamera(): void {\n        if (!this.camera) {\n            this.camera = this.getComponent(cc.Camera);\n        }\n\n        if (!this.camera) {\n            console.error('CameraFollow: 找不到相機組件');\n            return;\n        }\n\n        console.log('相機跟隨系統初始化完成');\n    }\n\n    /**\n     * 跟隨目標\n     */\n    private followTarget(deltaTime: number): void {\n        const targetPosition = this.target.position.clone();\n        const currentPosition = this.camera.node.position.clone();\n\n        // 計算目標位置\n        let targetX = currentPosition.x;\n        let targetY = currentPosition.y;\n\n        if (this.followX) {\n            targetX = targetPosition.x + this.offsetX;\n        }\n\n        if (this.followY) {\n            targetY = targetPosition.y + this.offsetY;\n        }\n\n        // 計算新位置\n        let newPosition: cc.Vec3;\n\n        if (this.smoothFollow) {\n            // 平滑跟隨\n            const lerpFactor = this.followSpeed * deltaTime;\n            newPosition = cc.v3(\n                cc.lerp(currentPosition.x, targetX, lerpFactor),\n                cc.lerp(currentPosition.y, targetY, lerpFactor),\n                currentPosition.z\n            );\n        } else {\n            // 直接跟隨\n            newPosition = cc.v3(targetX, targetY, currentPosition.z);\n        }\n\n        // 更新相機位置\n        this.camera.node.position = newPosition;\n    }\n\n    /**\n     * 設定跟隨目標\n     */\n    public setTarget(target: cc.Node): void {\n        this.target = target;\n        console.log('相機跟隨目標已設定');\n    }\n\n    /**\n     * 設定跟隨偏移\n     */\n    public setOffset(x: number, y: number): void {\n        this.offsetX = x;\n        this.offsetY = y;\n    }\n\n    /**\n     * 設定跟隨速度\n     */\n    public setFollowSpeed(speed: number): void {\n        this.followSpeed = speed;\n    }\n}"]}